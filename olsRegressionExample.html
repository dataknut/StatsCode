<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ben Anderson (b.anderson@soton.ac.uk, @dataknut)" />


<title>OLS Regression modeling in R</title>

<script src="olsRegressionExample_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="olsRegressionExample_files/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="olsRegressionExample_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="olsRegressionExample_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="olsRegressionExample_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="olsRegressionExample_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="olsRegressionExample_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="olsRegressionExample_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="olsRegressionExample_files/navigation-1.1/tabsets.js"></script>
<link href="olsRegressionExample_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="olsRegressionExample_files/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">OLS Regression modeling in R</h1>
<h4 class="author"><em>Ben Anderson (<a href="mailto:b.anderson@soton.ac.uk">b.anderson@soton.ac.uk</a>, <code>@dataknut</code>)</em></h4>
<h4 class="date"><em>Last run at: 2017-07-06 21:06:06</em></h4>

</div>


<div id="why-are-we-here" class="section level1">
<h1><span class="header-section-number">1</span>  Why are we here?</h1>
<p>To learn how to do ols regression modelling in R (markdown) and specifically how to use broom <span class="citation">(Robinson 2016)</span> and car <span class="citation">(Fox and Weisberg 2011)</span> for diagnostics, stargazer <span class="citation">(Hlavac 2015)</span> for model tables, data.table <span class="citation">(Dowle et al. 2015)</span> for data manipulation and ggplot <span class="citation">(Wickham 2009)</span> for results visualisation.</p>
<p>For more on regression try: <a href="http://socserv.socsci.mcmaster.ca/jfox/Courses/Brazil-2009/index.html" class="uri">http://socserv.socsci.mcmaster.ca/jfox/Courses/Brazil-2009/index.html</a></p>
<p>So many birds and just one stone…</p>
<pre class="r"><code># R has a very useful built-in dataset called mtcars
# http://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html

# A data frame with 32 observations on 11 variables.
# [, 1]     mpg     Miles/(US) gallon
# [, 2]     cyl     Number of cylinders
# [, 3]     disp    Displacement (cu.in.)
# [, 4]     hp  Gross horsepower
# [, 5]     drat    Rear axle ratio
# [, 6]     wt  Weight (1000 lbs)
# [, 7]     qsec    1/4 mile time
# [, 8]     vs  V/S
# [, 9]     am  Transmission (0 = automatic, 1 = manual)
# [,10]     gear    Number of forward gears
# [,11]     carb    Number of carburetors 

# Load required packages ----
x &lt;- c(&quot;rms&quot;, #  regression tools
       &quot;stargazer&quot;, # nice reporting of regressions
       &quot;car&quot;, # regression tools
       &quot;broom&quot;, # for tidying regression results
       &quot;ggplot2&quot;, # for displaying regression results
       &quot;data.table&quot; # for fast data manipulation
       )
       
# do this to install them first if needed
#install.packages(x)
print(&quot;Loading required packages&quot;)</code></pre>
<pre><code>## [1] &quot;Loading required packages&quot;</code></pre>
<pre class="r"><code># be careful - this will return a FALSE if a package doesn&#39;t load but the script will NOT stop!
lapply(x, require, character.only = T)</code></pre>
<pre><code>## [[1]]
## [1] TRUE
## 
## [[2]]
## [1] TRUE
## 
## [[3]]
## [1] TRUE
## 
## [[4]]
## [1] TRUE
## 
## [[5]]
## [1] TRUE
## 
## [[6]]
## [1] TRUE</code></pre>
<pre class="r"><code># Load mtcars ----
mtcars &lt;- mtcars

summary(mtcars) # base method</code></pre>
<pre><code>##       mpg             cyl             disp             hp       
##  Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0  
##  1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5  
##  Median :19.20   Median :6.000   Median :196.3   Median :123.0  
##  Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7  
##  3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0  
##  Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0  
##       drat             wt             qsec             vs        
##  Min.   :2.760   Min.   :1.513   Min.   :14.50   Min.   :0.0000  
##  1st Qu.:3.080   1st Qu.:2.581   1st Qu.:16.89   1st Qu.:0.0000  
##  Median :3.695   Median :3.325   Median :17.71   Median :0.0000  
##  Mean   :3.597   Mean   :3.217   Mean   :17.85   Mean   :0.4375  
##  3rd Qu.:3.920   3rd Qu.:3.610   3rd Qu.:18.90   3rd Qu.:1.0000  
##  Max.   :4.930   Max.   :5.424   Max.   :22.90   Max.   :1.0000  
##        am              gear            carb      
##  Min.   :0.0000   Min.   :3.000   Min.   :1.000  
##  1st Qu.:0.0000   1st Qu.:3.000   1st Qu.:2.000  
##  Median :0.0000   Median :4.000   Median :2.000  
##  Mean   :0.4062   Mean   :3.688   Mean   :2.812  
##  3rd Qu.:1.0000   3rd Qu.:4.000   3rd Qu.:4.000  
##  Max.   :1.0000   Max.   :5.000   Max.   :8.000</code></pre>
</div>
<div id="examine-dataset" class="section level1">
<h1><span class="header-section-number">2</span> Examine dataset</h1>
<pre class="r"><code>names(mtcars)</code></pre>
<pre><code>##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<pre class="r"><code>pairs(~mpg + disp + hp + drat + wt, labels = c(&quot;Mpg&quot;, &quot;Displacement&quot;, &quot;Horse power&quot;, 
    &quot;Rear axle rotation&quot;, &quot;Weight&quot;), data = mtcars, main = &quot;Simple Scatterplot Matrix&quot;)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/examine%20data-1.png" /><!-- --></p>
<p>Establish normality of mpg (outcome variable of interest).</p>
<pre class="r"><code>hist(mtcars$mpg)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/normality-1.png" /><!-- --></p>
<pre class="r"><code>qqnorm(mtcars$mpg)
qqline(mtcars$mpg, col = 2)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/normality-2.png" /><!-- --></p>
<pre class="r"><code>shapiro.test(mtcars$mpg)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  mtcars$mpg
## W = 0.94756, p-value = 0.1229</code></pre>
<pre class="r"><code># if p &gt; 0.05 =&gt; normal

# is it? Beware: shapiro-wilks is less robust as N -&gt;</code></pre>
</div>
<div id="model-with-1-term-predicting-mpg" class="section level1">
<h1><span class="header-section-number">3</span> Model with 1 term predicting mpg</h1>
<pre class="r"><code># qsec = time to go 1/4 mile from stationary
mpgModel1 &lt;- lm(mpg ~ qsec, mtcars)

# results?
summary(mpgModel1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ qsec, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8760 -3.4539 -0.7203  2.2774 11.6491 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -5.1140    10.0295  -0.510   0.6139  
## qsec          1.4121     0.5592   2.525   0.0171 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.564 on 30 degrees of freedom
## Multiple R-squared:  0.1753, Adjusted R-squared:  0.1478 
## F-statistic: 6.377 on 1 and 30 DF,  p-value: 0.01708</code></pre>
<pre class="r"><code># Diagnostics ----

plot(mpgModel1)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-1.png" /><!-- --><img src="olsRegressionExample_files/figure-html/model%201-2.png" /><!-- --><img src="olsRegressionExample_files/figure-html/model%201-3.png" /><!-- --><img src="olsRegressionExample_files/figure-html/model%201-4.png" /><!-- --></p>
<pre class="r"><code># normality of residuals
hist(mpgModel1$residuals)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-5.png" /><!-- --></p>
<pre class="r"><code>qqnorm(mpgModel1$residuals)
qqline(mpgModel1$residuals, col = 2)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-6.png" /><!-- --></p>
<pre class="r"><code>shapiro.test(mpgModel1$residuals)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  mpgModel1$residuals
## W = 0.94193, p-value = 0.08494</code></pre>
<pre class="r"><code># it is usual to do these checks for standardised residuals - but the
# results are the same add casewise diagnostics back into dataframe
mtcars$studentised.residuals &lt;- rstudent(mpgModel1)

qqnorm(mtcars$studentised.residuals)
qqline(mtcars$studentised.residuals, col = 2)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-7.png" /><!-- --></p>
<pre class="r"><code>shapiro.test(mtcars$studentised.residuals)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  mtcars$studentised.residuals
## W = 0.93996, p-value = 0.07469</code></pre>
<pre class="r"><code># if p &gt; 0.05 =&gt; normal is it?  But don&#39;t rely on the test espcially with
# large n

# The &#39;car&#39; package has some nice graphs to help here
qqPlot(mpgModel1)  # shows default 95% CI</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-8.png" /><!-- --></p>
<pre class="r"><code>spreadLevelPlot(mpgModel1)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-9.png" /><!-- --></p>
<pre><code>## 
## Suggested power transformation:  -1.490415</code></pre>
<pre class="r"><code># Do we think the variance of the residuals is constant?  Did the plot
# suggest a transformation? If so, why?

# autocorrelation/independence of errors
durbinWatsonTest(mpgModel1)</code></pre>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1       0.5922771     0.8065068   0.002
##  Alternative hypothesis: rho != 0</code></pre>
<pre class="r"><code># if p &lt; 0.05 then a problem as implies autocorrelation what should we
# conclude? Why? Could you have spotted that in the model summary?

# homoskedasticity
plot(mtcars$mpg, mpgModel1$residuals)
abline(h = mean(mpgModel1$residuals), col = &quot;red&quot;)  # add the mean of the residuals (yay, it&#39;s zero!)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/model%201-10.png" /><!-- --></p>
<pre class="r"><code># formal test
ncvTest(mpgModel1)</code></pre>
<pre><code>## Non-constant Variance Score Test 
## Variance formula: ~ fitted.values 
## Chisquare = 0.956535    Df = 1     p = 0.3280614</code></pre>
<pre class="r"><code># if p &gt; 0.05 then there is heteroskedasticity what do we conclude from the
# tests?</code></pre>
<p>go back to the model - what can we conclude from it?</p>
<pre class="r"><code>summary(mpgModel1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ qsec, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8760 -3.4539 -0.7203  2.2774 11.6491 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -5.1140    10.0295  -0.510   0.6139  
## qsec          1.4121     0.5592   2.525   0.0171 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.564 on 30 degrees of freedom
## Multiple R-squared:  0.1753, Adjusted R-squared:  0.1478 
## F-statistic: 6.377 on 1 and 30 DF,  p-value: 0.01708</code></pre>
</div>
<div id="model-with-more-than-1-term" class="section level1">
<h1><span class="header-section-number">4</span> Model with more than 1 term</h1>
<p>So our model was mostly OK (one violated assumption?) but the r sq was quite low.</p>
<p>Maybe we should add the car’s weight?</p>
<pre class="r"><code># wt = weight of car
mpgModel2 &lt;- lm(mpg ~ qsec + wt, mtcars)

# results?
summary(mpgModel2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ qsec + wt, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.3962 -2.1431 -0.2129  1.4915  5.7486 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  19.7462     5.2521   3.760 0.000765 ***
## qsec          0.9292     0.2650   3.506 0.001500 ** 
## wt           -5.0480     0.4840 -10.430 2.52e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.596 on 29 degrees of freedom
## Multiple R-squared:  0.8264, Adjusted R-squared:  0.8144 
## F-statistic: 69.03 on 2 and 29 DF,  p-value: 9.395e-12</code></pre>
<pre class="r"><code># Diagnostics ---- we whould run the same checks e.g.:
qqPlot(mpgModel2)  # shows default 95% CI</code></pre>
<p><img src="olsRegressionExample_files/figure-html/add%20wt-1.png" /><!-- --></p>
<pre class="r"><code>spreadLevelPlot(mpgModel2)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/add%20wt-2.png" /><!-- --></p>
<pre><code>## 
## Suggested power transformation:  0.4388755</code></pre>
<pre class="r"><code># but also additional assumption checks (now there are 2 predictors)

# collinearity
vif(mpgModel2)</code></pre>
<pre><code>##     qsec       wt 
## 1.031487 1.031487</code></pre>
<pre class="r"><code># if any values &gt; 10 -&gt; problem

# tolerance
1/vif(mpgModel2)</code></pre>
<pre><code>##      qsec        wt 
## 0.9694744 0.9694744</code></pre>
<pre class="r"><code># if any values &lt; 0.2 -&gt; possible problem if any values &lt; 0.1 -&gt; definitely
# a problem

# autocorrelation/independence of errors
durbinWatsonTest(mpgModel2)</code></pre>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1       0.2438102       1.49595   0.088
##  Alternative hypothesis: rho != 0</code></pre>
<pre class="r"><code># if p &lt; 0.05 then a problem as implies autocorrelation

# comparing models as a reminder:
summary(mpgModel1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ qsec, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8760 -3.4539 -0.7203  2.2774 11.6491 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -5.1140    10.0295  -0.510   0.6139  
## qsec          1.4121     0.5592   2.525   0.0171 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.564 on 30 degrees of freedom
## Multiple R-squared:  0.1753, Adjusted R-squared:  0.1478 
## F-statistic: 6.377 on 1 and 30 DF,  p-value: 0.01708</code></pre>
<pre class="r"><code>summary(mpgModel2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ qsec + wt, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.3962 -2.1431 -0.2129  1.4915  5.7486 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  19.7462     5.2521   3.760 0.000765 ***
## qsec          0.9292     0.2650   3.506 0.001500 ** 
## wt           -5.0480     0.4840 -10.430 2.52e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.596 on 29 degrees of freedom
## Multiple R-squared:  0.8264, Adjusted R-squared:  0.8144 
## F-statistic: 69.03 on 2 and 29 DF,  p-value: 9.395e-12</code></pre>
<pre class="r"><code># test significant difference between models
anova(mpgModel1, mpgModel2)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: mpg ~ qsec
## Model 2: mpg ~ qsec + wt
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1     30 928.66                                  
## 2     29 195.46  1    733.19 108.78 2.519e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code># what should we conclude from that?</code></pre>
<p>Whilst we’re here we should also plot the residuals. h/t to <a href="https://gist.github.com/apreshill/9d33891b5f9be4669ada20f76f101baa" class="uri">https://gist.github.com/apreshill/9d33891b5f9be4669ada20f76f101baa</a> for this.</p>
<pre class="r"><code># save the residuals via broom
resids &lt;- augment(mpgModel2)

# plot fitted vs residuals
ggplot(resids, aes(x = .fitted, y = .resid)) + geom_point(size = 1)</code></pre>
<p><img src="olsRegressionExample_files/figure-html/plot%20residuals-1.png" /><!-- --></p>
<p>Hopefully we didn’t see any obviously strange patterns (unlike that <a href="https://gist.github.com/apreshill/9d33891b5f9be4669ada20f76f101baa">gist</a>).</p>
</div>
<div id="reporting-ols-results-with-confidence-intervals" class="section level1">
<h1><span class="header-section-number">5</span> Reporting OLS results with confidence intervals</h1>
<p>The p values tell you whether the ‘effect’ (co-efficient) is statistically significant. But only <em>you</em> can decide if it is IMPORTANT!</p>
<p>It is usually better to calculate and inspect confidence intervals for your estimates.</p>
<p>This indicates:</p>
<ul>
<li>statistical significance (if the CIs do not include 0) - just like the p value</li>
<li>precision - the width of the CIs shows you how precise your estimate is</li>
</ul>
<p>You can calculate them using the standard error (s.e.) from the summary:</p>
<ul>
<li>lower = estimate - (s.e.*1.96)</li>
<li>upper = estimate + (s.e.*1.96)</li>
<li>just like for t tests etc (in fact this <em>is</em> a t test!!)</li>
</ul>
<p>Or use <code>confint()</code> which is more precise.</p>
<p>Print out the summaries again and calculate 95% confidence intervals each time.</p>
<pre class="r"><code># Model 1
# use confint to report confidence intervals with bonferroni corrected level
bc_p1 &lt;- 0.05/length(mpgModel1$coefficients)

# save results as log odds
# the cbind function simply &#39;glues&#39; the columns together side by side
mpgModel1Results_bf &lt;- cbind(Coef = coef(mpgModel1), # coefficients
                              confint(mpgModel1, level = 1 - bc_p1), # 95% CI
                             Pr = round(summary(mpgModel1)$coefficients[,4], 3) # p value if required
                             )
mpgModel1Results_bf</code></pre>
<pre><code>##                  Coef       1.25 %   98.75 %    Pr
## (Intercept) -5.114038 -28.77937200 18.551296 0.614
## qsec         1.412125   0.09263361  2.731616 0.017</code></pre>
<pre class="r"><code># Model 2
# use confint to report confidence intervals with bonferroni corrected level
bc_p2 &lt;- 0.05/length(mpgModel2$coefficients)

# save results as log odds
# the cbind function simply &#39;glues&#39; the columns together side by side
mpgModel2Results_bf &lt;- cbind(Coef = coef(mpgModel2), 
                            confint(mpgModel2, level = 1 - bc_p2))

mpgModel2Results_bf</code></pre>
<pre><code>##                  Coef    0.833 %  99.167 %
## (Intercept) 19.746223  6.4012162 33.091229
## qsec         0.929198  0.2558134  1.602583
## wt          -5.047982 -6.2777749 -3.818189</code></pre>
<p>Now we’ll try reporting the two model using the stargazer package to get pretty tables. Note we use options to automatically create the 95% CI and to report the results on just one line per predictor. This is especially helpful for models with a lot of variables.</p>
<pre class="r"><code>stargazer(mpgModel1, mpgModel2, title = &quot;Model results&quot;, ci = TRUE, single.row = TRUE, 
    type = &quot;html&quot;)</code></pre>
<table style="text-align:center">
<caption>
<strong>Model results</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
mpg
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
qsec
</td>
<td>
1.412<sup>**</sup> (0.316, 2.508)
</td>
<td>
0.929<sup>***</sup> (0.410, 1.449)
</td>
</tr>
<tr>
<td style="text-align:left">
wt
</td>
<td>
</td>
<td>
-5.048<sup>***</sup> (-5.997, -4.099)
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
-5.114 (-24.772, 14.544)
</td>
<td>
19.746<sup>***</sup> (9.452, 30.040)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
32
</td>
<td>
32
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.175
</td>
<td>
0.826
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.148
</td>
<td>
0.814
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
5.564 (df = 30)
</td>
<td>
2.596 (df = 29)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
6.377<sup>**</sup> (df = 1; 30)
</td>
<td>
69.033<sup>***</sup> (df = 2; 29)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
</div>
<div id="visualise-results-using-ggplot" class="section level1">
<h1><span class="header-section-number">6</span> Visualise results using ggplot</h1>
<p>Now we’ll visualise them using broom and ggplot. Just to confuse you we’re going to convert the data frames to data.tables. It makes little difference here but data.table is good to get to know for <code>data science</code>.</p>
<pre class="r"><code># Broom converts the model results into a data frame (very useful!)
mpgModel1DT &lt;- as.data.table(tidy(mpgModel1))
mpgModel1DT$ci_lower &lt;- mpgModel1DT$estimate - qnorm(0.975) * mpgModel1DT$std.error 
mpgModel1DT$ci_upper &lt;- mpgModel1DT$estimate + qnorm(0.975) * mpgModel1DT$std.error
mpgModel1DT &lt;- mpgModel1DT[, model := &quot;Model 1&quot;] # add model label for ggplot to pick up
mpgModel2DT &lt;- as.data.table(tidy(mpgModel2))
mpgModel2DT$ci_lower &lt;- mpgModel2DT$estimate - qnorm(0.975) * mpgModel2DT$std.error 
mpgModel2DT$ci_upper &lt;- mpgModel2DT$estimate + qnorm(0.975) * mpgModel2DT$std.error
mpgModel2DT &lt;- mpgModel2DT[, model := &quot;Model 2&quot;] # add model label for ggplot to pick up

modelsDT &lt;- rbind(mpgModel1DT, mpgModel2DT)
  
ggplot(modelsDT, aes(x=term, y=estimate, fill = model)) + 
  geom_bar(position=position_dodge(), stat=&quot;identity&quot;) + 
  geom_errorbar(aes(ymin=ci_lower, ymax=ci_upper), width=.2, # Width of the error bars 
                position=position_dodge(.9)) +
  labs(title = &quot;Model results&quot;,
       x = &#39;Variable&#39;,
       y = &#39;Coefficient&#39;,
       caption = &quot;Model results, 95% CI&quot;) +
  coord_flip() # rotate for legibility</code></pre>
<p><img src="olsRegressionExample_files/figure-html/visualise%20models-1.png" /><!-- --></p>
</div>
<div id="about" class="section level1">
<h1><span class="header-section-number">7</span> About</h1>
<div id="runtime" class="section level2">
<h2><span class="header-section-number">7.1</span> Runtime</h2>
<p>Analysis completed in: 6.52 seconds using <a href="https://cran.r-project.org/package=knitr">knitr</a> in <a href="http://www.rstudio.com">RStudio</a> with R version 3.4.0 (2017-04-21) running on x86_64-apple-darwin15.6.0.</p>
<p>R packages used:</p>
<ul>
<li>base R - for the basics <span class="citation">(R Core Team 2016)</span></li>
<li>ggplot2 - for slick graphics <span class="citation">(Wickham 2009)</span></li>
<li>car - for regression diagnostics <span class="citation">(Fox and Weisberg 2011)</span></li>
<li>broom - for tidy model results <span class="citation">(Robinson 2016)</span></li>
<li>data.table - for fast data manipulation <span class="citation">(Dowle et al. 2015)</span></li>
<li>knitr - to create this document <span class="citation">(Xie 2016)</span></li>
</ul>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-data.table">
<p>Dowle, M, A Srinivasan, T Short, S Lianoglou with contributions from R Saporta, and E Antonyan. 2015. <em>Data.table: Extension of Data.frame</em>. <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div id="ref-car">
<p>Fox, John, and Sanford Weisberg. 2011. <em>An R Companion to Applied Regression</em>. Second. Thousand Oaks CA: Sage. <a href="http://socserv.socsci.mcmaster.ca/jfox/Books/Companion" class="uri">http://socserv.socsci.mcmaster.ca/jfox/Books/Companion</a>.</p>
</div>
<div id="ref-stargazer">
<p>Hlavac, Marek. 2015. <em>Stargazer: Well-Formatted Regression and Summary Statistics Tables</em>. Cambridge, USA: Harvard University. <a href="http://CRAN.R-project.org/package=stargazer" class="uri">http://CRAN.R-project.org/package=stargazer</a>.</p>
</div>
<div id="ref-baseR">
<p>R Core Team. 2016. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-broom">
<p>Robinson, David. 2016. <em>Broom: Convert Statistical Analysis Objects into Tidy Data Frames</em>. <a href="https://CRAN.R-project.org/package=broom" class="uri">https://CRAN.R-project.org/package=broom</a>.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-knitr">
<p>Xie, Yihui. 2016. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. <a href="https://CRAN.R-project.org/package=knitr" class="uri">https://CRAN.R-project.org/package=knitr</a>.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
