<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ben Anderson (Contact: b.anderson@soton.ac.uk, @dataknut)" />


<title>Testing drake</title>

<script src="drake_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="drake_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="drake_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="drake_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="drake_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="drake_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="drake_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="drake_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="drake_files/navigation-1.1/tabsets.js"></script>
<script src="drake_files/navigation-1.1/codefolding.js"></script>
<link href="drake_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="drake_files/highlightjs-9.12.0/highlight.js"></script>
<script src="drake_files/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Testing drake</h1>
<h3 class="subtitle"><em>Using NZ Electricity Authority grid level generation data</em></h3>
<h4 class="author"><em>Ben Anderson (Contact: <a href="mailto:b.anderson@soton.ac.uk">b.anderson@soton.ac.uk</a>, <code>@dataknut</code>)</em></h4>
<h4 class="date"><em>Last run at: 2019-04-30 11:35:03</em></h4>

</div>


<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Use the <a href="https://ropenscilabs.github.io/drake-manual/">drake</a> <span class="citation">(Landau 2019)</span> R package to make data flow, analysis and reporting pipelines. Drake looks after which bits of the pipeline need refreshing every time you re-run the drake <em>plan</em>. So when you run the report as part of your plan (see <a href="drake.R" class="uri">drake.R</a>), you can <code>readd</code> the objects you created in the R script to report them in this .Rmd file.</p>
</div>
<div id="data" class="section level1">
<h1><span class="header-section-number">2</span> Data</h1>
<p>For example, in Table <a href="#tab:desc">2.1</a> we <code>drake::readd</code> NZ Electricity Authority generation data for June 2018 which we downloaded in <a href="drake.R" class="uri">drake.R</a> from <a href="https://www.emi.ea.govt.nz/Wholesale/Datasets/Generation/Generation_MD/201806_Generation_MD.csv" class="uri">https://www.emi.ea.govt.nz/Wholesale/Datasets/Generation/Generation_MD/201806_Generation_MD.csv</a> and present a summary.</p>
<pre class="r"><code># readd the data object

dt &lt;- drake::readd(data)

t &lt;- summary(dt)

kableExtra::kable(t, caption = &quot;Data summary&quot;) %&gt;%
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:desc">Table 2.1: </span>Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Site_Code
</th>
<th style="text-align:left;">
POC_Code
</th>
<th style="text-align:left;">
Nwk_Code
</th>
<th style="text-align:left;">
Gen_Code
</th>
<th style="text-align:left;">
Fuel_Code
</th>
<th style="text-align:left;">
Tech_Code
</th>
<th style="text-align:left;">
Trading_date
</th>
<th style="text-align:left;">
Time_Period
</th>
<th style="text-align:left;">
<pre><code>  kWh &lt;/th&gt;</code></pre>
<th style="text-align:left;">
<pre><code>rTime &lt;/th&gt;</code></pre>
<th style="text-align:left;">
<pre><code> rDate &lt;/th&gt;</code></pre>
<th style="text-align:left;">
rDateTime
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Min. :2018-06-01
</td>
<td style="text-align:left;">
TP1 : 2130
</td>
<td style="text-align:left;">
Min. : 0
</td>
<td style="text-align:left;">
Length:106500
</td>
<td style="text-align:left;">
Min. :2018-06-01
</td>
<td style="text-align:left;">
Min. :2018-06-01 00:15:00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
Class :character
</td>
<td style="text-align:left;">
1st Qu.:2018-06-08
</td>
<td style="text-align:left;">
TP2 : 2130
</td>
<td style="text-align:left;">
1st Qu.: 5376
</td>
<td style="text-align:left;">
Class1:hms
</td>
<td style="text-align:left;">
1st Qu.:2018-06-08
</td>
<td style="text-align:left;">
1st Qu.:2018-06-08 12:07:30
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Mode :character
</td>
<td style="text-align:left;">
Median :2018-06-15
</td>
<td style="text-align:left;">
TP3 : 2130
</td>
<td style="text-align:left;">
Median : 17757
</td>
<td style="text-align:left;">
Class2:difftime
</td>
<td style="text-align:left;">
Median :2018-06-15
</td>
<td style="text-align:left;">
Median :2018-06-16 00:00:00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Mean :2018-06-15
</td>
<td style="text-align:left;">
TP4 : 2130
</td>
<td style="text-align:left;">
Mean : 36137
</td>
<td style="text-align:left;">
Mode :numeric
</td>
<td style="text-align:left;">
Mean :2018-06-15
</td>
<td style="text-align:left;">
Mean :2018-06-16 00:00:00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3rd Qu.:2018-06-23
</td>
<td style="text-align:left;">
TP5 : 2130
</td>
<td style="text-align:left;">
3rd Qu.: 46740
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3rd Qu.:2018-06-23
</td>
<td style="text-align:left;">
3rd Qu.:2018-06-23 11:52:30
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Max. :2018-06-30
</td>
<td style="text-align:left;">
TP6 : 2130
</td>
<td style="text-align:left;">
Max. :397494
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Max. :2018-06-30
</td>
<td style="text-align:left;">
Max. :2018-06-30 23:45:00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
(Other):93720
</td>
<td style="text-align:left;">
NA’s :4260
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA’s :4260
</td>
</tr>
</tbody>
</table>
</div>
<div id="plot" class="section level1">
<h1><span class="header-section-number">3</span> Plot</h1>
<p>Now we <code>drake::readd</code> a plot we made using the data. Note that we don’t build the plot in the .Rmd file (via knitr) we just bring back the object from wherever drake stored it and present it as Figure <a href="#fig:plot">3.1</a>.</p>
<pre class="r"><code>p &lt;- drake::readd(profilePlot) # we don&#39;t need to create the p but this would let us add stuff to the plot

p</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (position_stack).</code></pre>
<div class="figure"><span id="fig:plot"></span>
<img src="drake_files/figure-html/plot-1.png" alt="Mean electricity generation in GWh per half hour for New Zealand in June (winter) 2018" width="672" />
<p class="caption">
Figure 3.1: Mean electricity generation in GWh per half hour for New Zealand in June (winter) 2018
</p>
</div>
<p>As you can see NZ generally uses hydro electricity to meet it’s winter peaks with infrequent coal &amp; gas peaking where needed.</p>
</div>
<div id="why-does-it-matter" class="section level1">
<h1><span class="header-section-number">4</span> Why does it matter?</h1>
<p>This is all really rather cool…</p>
<p>But the very cool bit is that if we make some changes to the code that makes the plot, when we re-make our drake plan, drake will only re-build the plot and the report. It will not go and get the data again - it knows we didn’t change the code that got the data so it leaves it alone. This means you can run the data loading process <em>once</em> and never have to repeat it no matter how many times you edit the subsequent R code or the .Rmd. This makes a huge difference to <a href="https://twitter.com/dataknut/status/1122687379989417985">overall runtime for repeat report knits</a> (for example)…</p>
</div>
<div id="r-environment" class="section level1">
<h1><span class="header-section-number">5</span> R environment</h1>
<p>Packages used:</p>
<ul>
<li>curl <span class="citation">(Ooms 2019)</span></li>
<li>data.table <span class="citation">(Dowle et al. 2015)</span></li>
<li>drake <span class="citation">(Landau 2019)</span></li>
<li>ggplot2 <span class="citation">(Wickham 2009)</span></li>
<li>kableExtra <span class="citation">(Zhu 2018)</span></li>
<li>lubridate <span class="citation">(Grolemund and Wickham 2011)</span></li>
</ul>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-data.table">
<p>Dowle, M, A Srinivasan, T Short, S Lianoglou with contributions from R Saporta, and E Antonyan. 2015. <em>Data.table: Extension of Data.frame</em>. <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div id="ref-lubridate">
<p>Grolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with lubridate.” <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="http://www.jstatsoft.org/v40/i03/" class="uri">http://www.jstatsoft.org/v40/i03/</a>.</p>
</div>
<div id="ref-drake">
<p>Landau, William Michael. 2019. <em>Drake: A Pipeline Toolkit for Reproducible Computation at Scale</em>. <a href="https://CRAN.R-project.org/package=drake" class="uri">https://CRAN.R-project.org/package=drake</a>.</p>
</div>
<div id="ref-curl">
<p>Ooms, Jeroen. 2019. <em>Curl: A Modern and Flexible Web Client for R</em>. <a href="https://CRAN.R-project.org/package=curl" class="uri">https://CRAN.R-project.org/package=curl</a>.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-kableExtra">
<p>Zhu, Hao. 2018. <em>KableExtra: Construct Complex Table with ’Kable’ and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra" class="uri">https://CRAN.R-project.org/package=kableExtra</a>.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
